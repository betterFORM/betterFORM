<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: orderlist.xhtml 2521 2007-03-26 09:05:09Z joernt $ -->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xf="http://www.w3.org/2002/xforms"
      xmlns:ev="http://www.w3.org/2001/xml-events">
<head>
    <title>Order List</title>
    <meta name="author" content="joernt at users.sourceforge.net"/>
    <meta name="author" content="lars.windauer at chiba-project.org"/>
    <meta name="author" content="tobias.krebs at betterform.de"/>
    <meta name="author" content="fabian.otto at betterform.de"/>

    <meta name="description" content="XForms demo of a simple order list"/>


    <link rel="stylesheet" type="text/css" href="../../styles/bf.css"/>
    <link rel="stylesheet" type="text/css" href="../../resources/styles/demo.css"/>

    <script type="text/javascript">
        dojo.require("dijit.Dialog");
    </script>
</head>
<body class="soria" style="margin:30px;">
<div id="xforms">
<div style="display:none">
    <xf:model>
        <xf:instance xmlns="">
            <order>
                <item amount="1" price="0.50" taxValue="0" sum="0">eraser</item>
                <item amount="1" price="2.50" taxValue="0" sum="">ballpoint_pen</item>
                <item amount="1" price="50.00" taxValue="0" sum="0">fountain_pen</item>
                <item amount="1" price="0" taxValue="0" sum="0"/>
            </order>
        </xf:instance>

        <xf:bind id="items" nodeset="item[position()!=last()]">
            <xf:bind id="article" nodeset="." required="true()"/>
            <xf:bind id="amount" nodeset="@amount" type="integer" required="true()" constraint=". &lt; 100"/>
            <xf:bind id="price" nodeset="@price" type="float"/>
            <xf:bind id="taxValue" nodeset="@taxValue" calculate="../@amount * ../@price * instance('shippingAndTaxes')/country/tax" type="float"/>
            <xf:bind id="sum" nodeset="@sum" calculate="../@amount * ../@price * ( 1 + instance('shippingAndTaxes')/country/tax)" type="float"/>
        </xf:bind>

        <xf:instance id="shippingAndTaxes">
            <order xmlns="">
                <country>
                    <name>Germany</name>
                    <shipping>4.40</shipping>
                    <tax>0.19</tax>
                </country>
            </order>
        </xf:instance>

        <xf:bind nodeset="instance('shippingAndTaxes')/country/tax" type="float"/>
        
        <xf:instance id="template">
            <order xmlns="">
                <item amount="1" price="1.50" taxValue="0" sum="0">pencil</item>
            </order>
        </xf:instance>

        <!--
        <xf:instance id="items">
            <items xmlns="">
                <item price="0.50">Eraser</item>
                <item price="1.50">Pencil</item>
                <item price="2.49">Ballpoint pen</item>
                <item price="3.99">Spiral notebook</item>
                <item price="50.00">Fountain pen</item>
                <item price="69.98">Shredder</item>
                <template>Eraser</template>
            </items>
        </xf:instance>

        <xf:bind id="articles" nodeset="instance('items')"/>
        
        <xf:instance id="userItem">
            <order xmlns="">
                <item price="0"/>
            </order>
        </xf:instance>

        <xf:bind nodeset="instance('userItem')/item">
            <xf:bind nodeset="." type="normalizedString" constraint="string-length(.) &gt; 1"/>
            <xf:bind nodeset="@price" type="float" constraint=". &gt; 0"/>
        </xf:bind>
        -->
        
        <xf:instance id="countries">
            <contries xmlns="">
                <country>
                    <name>Albania</name>
                    <shipping>12.50</shipping>
                    <tax>0.1</tax>
                </country>
                <country>
                    <name>Belgium</name>
                    <shipping>8.00</shipping>
                    <tax>0.2</tax>
                </country>
                <country>
                    <name>Cuba</name>
                    <shipping>30.00</shipping>
                    <tax>0.0</tax>
                </country>
                <country>
                    <name>Denmark</name>
                    <shipping>10.00</shipping>
                    <tax>0.21</tax>
                </country>
                <country>
                    <name>Estonia</name>
                    <shipping>15.00</shipping>
                    <tax>0.7</tax>
                </country>
                <country>
                    <name>France</name>
                    <shipping>8.50</shipping>
                    <tax>0.16</tax>
                </country>
                <country>
                    <name>Germany</name>
                    <shipping>4.40</shipping>
                    <tax>0.19</tax>
                </country>
                <country>
                    <name>Gibraltar</name>
                    <shipping>13.25</shipping>
                    <tax>0.125</tax>
                </country>
                <country>
                    <name>Hungary</name>
                    <shipping>14.00</shipping>
                    <tax>0.062</tax>
                </country>
                <country>
                    <name>Italy</name>
                    <shipping>0.08</shipping>
                    <tax>0.16</tax>
                </country>
                <country>
                    <name>Japan</name>
                    <shipping>40.00</shipping>
                    <tax>0.215</tax>
                </country>
                <country>
                    <name>Spain</name>
                    <shipping>9.00</shipping>
                    <tax>0.14</tax>
                </country>
            </contries>
        </xf:instance>





    </xf:model>
</div>
<div class="Section" dojotype="dijit.layout.ContentPane">
    <xf:group appearance="full" class="contactsFullGroup">
        <div class="Headline">Order List:</div>

        <div class="description">
            A simple calculated Order List with slightly formatted output.<br/>
            Tax and Shipping costs get calculated dependent on the country you choose.
        </div>
        <br/>

        <div class="orderListCountrySelect">
            <xf:select1 appearance="minimal" ref="instance('shippingAndTaxes')">
                <xf:label id="country">Ship to:</xf:label>
                <xf:hint>Choose your country for correct Tax and Shipping cost calculation</xf:hint>
                <xf:itemset nodeset="instance('countries')/country">
                    <xf:label ref="name"/>
                    <xf:copy ref="."/>
                </xf:itemset>
            </xf:select1>
        </div>

        <xf:group appearance="minimal">
            <xf:repeat id="repeatid" bind="items" appearance="compact" class="orderListRepeat">
              <xf:select1 bind="article">
                    <xf:label class="contactsRepeatHeader">Article</xf:label>
                    <xf:hint>Choose the item you wish to add to the orderlist</xf:hint>
                    <xf:choices>
                        <xf:item>
                            <xf:label>Eraser</xf:label>
                            <xf:value>eraser</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">0.50</xf:setvalue>
                        </xf:item>
                        <xf:item>
                            <xf:label>Pencil</xf:label>
                            <xf:value>pencil</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">1.50</xf:setvalue>
                        </xf:item>
                        <xf:item>
                            <xf:label>Ballpoint pen</xf:label>
                            <xf:value>ballpoint_pen</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">2.49</xf:setvalue>
                        </xf:item>
                        <xf:item>
                            <xf:label>Spiral notebook</xf:label>
                            <xf:value>spiral_notebook</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">3.99</xf:setvalue>
                        </xf:item>
                        <xf:item>
                            <xf:label>Fountain pen</xf:label>
                            <xf:value>fountain_pen</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">50.00</xf:setvalue>
                        </xf:item>
                        <xf:item>
                            <xf:label>Shredder</xf:label>
                            <xf:value>shredder</xf:value>
                            <xf:setvalue ev:event="xforms-select" bind="price">69.98</xf:setvalue>
                        </xf:item>
                    </xf:choices>
                </xf:select1>
                <!--
                <xf:select1 bind="article">
                    <xf:label class="contactsRepeatHeader">Article</xf:label>
                    <xf:hint>Choose the article you wish to add to the orderlist</xf:hint>
                    <xf:itemset nodeset="instance('items')/item">
                        <xf:label ref="."/>
                        <xf:value ref="."/>

                    </xf:itemset>
                </xf:select1>
                -->
                <xf:input bind="amount" incremental="true">
                    <xf:label class="contactsRepeatHeader">Amount</xf:label>
                    <xf:hint>Enter the amount of articles you would like to buy (99 items max)</xf:hint>
                    <xf:alert>You can order a maximum of 99 articles in one order</xf:alert>
                </xf:input>
                <xf:output value="format-number(@price, '€ 0.00')" class="text-right">
                    <xf:label class="contactsRepeatHeader">Price</xf:label>
                </xf:output>
                <xf:output value="format-number(instance('shippingAndTaxes')/country/tax , '0.00%')" class="text-right">
                    <xf:label class="contactsRepeatHeader">Tax %</xf:label>
                </xf:output>
                <xf:output value="format-number(@taxValue, '€ 0.00')" class="text-right">
                    <xf:label class="contactsRepeatHeader">Tax Value</xf:label>
                </xf:output>
                <xf:output value="format-number(@sum, '€ 0.00')" class="text-right">
                    <xf:label class="contactsRepeatHeader">Sum</xf:label>
                </xf:output>
            </xf:repeat>

            <div class="orderlistRepeatFooter">
                <xf:output id="shipping" value="format-number(instance('shippingAndTaxes')/country/shipping, '€ 0.00')">
                    <xf:label class="orderlistRepeatFooter">Shipping:</xf:label>
                </xf:output>
                <xf:output id="total"
                           value="format-number(sum(/order/item/@sum) + instance('shippingAndTaxes')/country/shipping, '€ 0.00')">
                    <xf:label>Total:</xf:label>
                </xf:output>
            </div>

        </xf:group>
    </xf:group>


    <xf:group appearance="minimal" class="orderListTriggerGroup">
        <!--
        <xf:trigger class="orderListNewTrigger">
            <xf:label>New item</xf:label>
            <xf:hint>Create new article for articlelist</xf:hint>
            <xf:action>
                <script type="text/javascript">
                    dijit.byId("itemDialog").show();
                </script>
            </xf:action>
        </xf:trigger>
        -->
        <xf:trigger class="orderListAddTrigger">
            <xf:label>Add item</xf:label>
            <xf:hint>Adds a new article to the orderlist</xf:hint>
            <xf:action>
                <xf:insert bind="items" at="last()" position="after" origin="instance('template')/item"
                           if="exists(instance()/item)"/>
                <xf:insert context="/order" at="last()" position="after" origin="instance('template')/item"
                           if="count(instance()/item) = 1"/>
            </xf:action>
        </xf:trigger>
        <xf:trigger class="orderListDelTrigger">>
            <xf:label>Delete item</xf:label>
            <xf:hint>Deletes selected article from orderlist</xf:hint>
            <xf:action>
                <xf:delete bind="items" at="index('repeatid')"/>
            </xf:action>
        </xf:trigger>
        <xf:trigger class="orderListResetTrigger">>
            <xf:label>Reset</xf:label>
            <xf:hint>Resets demo to inital state</xf:hint>
            <xf:action>
                <xf:reset/>
            </xf:action>
        </xf:trigger>




         <div style="float:left;padding-right:5px;">

    </div>

    <!--
    <div id="itemDialog" dojoType="dijit.Dialog" title="Insert new article into articlelist">
        <xf:group appearance="full" ref="instance('userItem')/item">
            <xf:input ref=".">
                <xf:label>Article name:</xf:label>
                <xf:hint>Enter the name of the new article</xf:hint>
                <xf:alert>Please enter an article name</xf:alert>
            </xf:input>
            <xf:input ref="@price">
                <xf:label>Article price:</xf:label>
                <xf:hint>Enter the price of the new article</xf:hint>
            </xf:input>

            <xf:group appearance="minimal" class="orderListTriggerGroup">
                <xf:trigger class="orderListOKTrigger">
                    <xf:label>Add new article</xf:label>
                    <xf:hint>Add the article to the articlelist</xf:hint>
                    <xf:action>
                        <script type="text/javascript">
                            dijit.byId("itemDialog").hide();
                        </script>
                        <xf:insert context="instance('items')" origin="instance('userItem')/item"/>
                        <xf:setvalue ref="instance('userItem')/item"></xf:setvalue>
                        <xf:setvalue ref="instance('userItem')/item/@price" value="'0'"/>
                    </xf:action>
                </xf:trigger>
                <xf:trigger class="orderListAbortTrigger">>
                    <xf:label>Abort</xf:label>
                    <xf:hint>Close dialog</xf:hint>
                    <xf:action>
                        <script type="text/javascript">
                            dijit.byId("itemDialog").hide();
                        </script>
                    </xf:action>
                </xf:trigger>
            </xf:group>
        </xf:group>
    </div>
    -->
    </xf:group>


</div>
</div>
</body>
</html>
